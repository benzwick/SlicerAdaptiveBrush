# ADR-009: Living Documentation Strategy

## Status

Proposed

## Context

Documentation often becomes stale because:

1. Code changes but docs don't get updated
2. Screenshots become outdated after UI changes
3. Manual documentation is tedious and error-prone
4. No verification that docs match actual behavior

We need a documentation system that:

- Updates automatically when code changes
- Generates screenshots from actual tests
- Stays in sync with test coverage
- Requires minimal manual maintenance

## Decision

Implement **living documentation** where tests drive documentation:

### Core Principles

1. **Tests are the source of truth** - if it's not tested, it's not documented
2. **Screenshots are generated, not captured** - tests produce screenshots automatically
3. **Docs are built from code** - documentation derives from docstrings and test files
4. **CI keeps everything in sync** - documentation regenerates on each commit

### Documentation Pipeline

```
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│   Tests     │────▶│ Screenshots  │────▶│    Docs     │
│  (pytest)   │     │  (captured)  │     │  (website)  │
└─────────────┘     └──────────────┘     └─────────────┘
       │                                        │
       └────────────────────────────────────────┘
                    CI Pipeline
```

### Screenshot Generation

Tests capture screenshots at key moments:

```python
def test_paint_bone_tissue(slicer_app):
    """Test painting with bone preset."""
    # Setup
    load_sample_data("CTChest")
    select_effect("Adaptive Brush")
    apply_preset("Bone")

    # Action
    paint_at_location(100, 150)

    # Capture for docs
    capture_screenshot("bone_preset_result.png")

    # Verify
    assert segment_volume() > 1000
```

### Documentation Structure

```
docs/
  index.md              # Auto-generated from README
  user-guide/
    getting-started.md  # From test_basic_workflow.py
    algorithms.md       # From test_algorithms.py
    presets.md          # From test_presets.py
  screenshots/          # Generated by tests
    bone_preset_result.png
    watershed_example.png
  api/                  # Generated from docstrings
    SegmentEditorEffect.md
```

### Website Generation

Use MkDocs or Sphinx with GitHub Pages:

```yaml
# .github/workflows/docs.yml
- name: Generate screenshots
  run: |
    Slicer --python-script scripts/generate_screenshots.py

- name: Build docs
  run: mkdocs build

- name: Deploy to GitHub Pages
  uses: peaceiris/actions-gh-pages@v3
```

### Claude's Role

Claude assists by:

1. **Writing documentation** that matches test behavior
2. **Generating test cases** from user-recorded sessions
3. **Updating docs** when tests change
4. **Ensuring consistency** between code, tests, and docs

## Consequences

### Positive

- Documentation is always current
- Screenshots reflect actual UI
- Tests verify documented behavior
- Reduced manual documentation effort
- Single source of truth

### Negative

- Initial setup is complex
- CI pipeline is slower (screenshot generation)
- Requires discipline to write tests that produce good docs
- Screenshot generation needs headless display (Xvfb)

## Alternatives Considered

### Traditional manual documentation

**Rejected**: Becomes stale, high maintenance burden.

### Wiki-based documentation

**Rejected**: Disconnected from code, no automated updates.

### README-only documentation

**Rejected**: Insufficient for complex features, no screenshots.

## Implementation Notes

### Screenshot Capture Utility

```python
def capture_screenshot(filename: str, view: str = "Red"):
    """Capture screenshot from Slicer view."""
    widget = slicer.app.layoutManager().sliceWidget(view)
    pixmap = qt.QPixmap.grabWidget(widget)
    pixmap.save(f"docs/screenshots/{filename}")
```

### MkDocs Configuration

```yaml
# mkdocs.yml
site_name: SlicerAdaptiveBrush
theme:
  name: material
nav:
  - Home: index.md
  - User Guide:
    - Getting Started: user-guide/getting-started.md
    - Algorithms: user-guide/algorithms.md
plugins:
  - search
  - mkdocstrings  # Generate API docs from docstrings
```

## References

- [MkDocs](https://www.mkdocs.org/)
- [GitHub Pages](https://pages.github.com/)
- [Living Documentation (Gojko Adzic)](https://gojko.net/books/specification-by-example/)
- [Slicer Screenshot Capture](https://slicer.readthedocs.io/en/latest/developer_guide/script_repository.html#capture-a-screenshot)
